
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Android7.0机型适配 | Android 学习之道</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="小强">
    

    
    <meta name="description" content="Android7.0机型适配存储目录的共享都知道现在AI都很火，AI必定会诞生一些下一代巨头企业，各行各业都争抢这一股风，百度CEO不扔下了公司的内务不管，一头扎进了AI的研究团队工作中，前段时间李彦宏驾着自己公司生产的无人驾驶汽车，就是6，各个大巨头都在AI方面有重要项目在实施，都争抢着下一个时代的山头。在物联网方面，做的不错的是小米，小米的生态链，聚集了70多家智能硬件公司，形成了小米生态链，">
<meta property="og:type" content="article">
<meta property="og:title" content="Android7.0机型适配">
<meta property="og:url" content="http://yoursite.com/2017/04/06/Android7.0机型适配/index.html">
<meta property="og:site_name" content="Android 学习之道">
<meta property="og:description" content="Android7.0机型适配存储目录的共享都知道现在AI都很火，AI必定会诞生一些下一代巨头企业，各行各业都争抢这一股风，百度CEO不扔下了公司的内务不管，一头扎进了AI的研究团队工作中，前段时间李彦宏驾着自己公司生产的无人驾驶汽车，就是6，各个大巨头都在AI方面有重要项目在实施，都争抢着下一个时代的山头。在物联网方面，做的不错的是小米，小米的生态链，聚集了70多家智能硬件公司，形成了小米生态链，">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2017/11/9/273e2014d8fa7673c6d438ebe50a592f?w=640&h=426&f=jpeg&s=47213">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2017/11/9/ec8c02abbf21a89ed4daffd611b8e6d5?w=640&h=457&f=jpeg&s=42366">
<meta property="og:updated_time" content="2018-01-03T05:44:53.886Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android7.0机型适配">
<meta name="twitter:description" content="Android7.0机型适配存储目录的共享都知道现在AI都很火，AI必定会诞生一些下一代巨头企业，各行各业都争抢这一股风，百度CEO不扔下了公司的内务不管，一头扎进了AI的研究团队工作中，前段时间李彦宏驾着自己公司生产的无人驾驶汽车，就是6，各个大巨头都在AI方面有重要项目在实施，都争抢着下一个时代的山头。在物联网方面，做的不错的是小米，小米的生态链，聚集了70多家智能硬件公司，形成了小米生态链，">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2017/11/9/273e2014d8fa7673c6d438ebe50a592f?w=640&h=426&f=jpeg&s=47213">

    
    <link rel="alternative" href="/atom.xml" title="Android 学习之道" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/fav.png">
    
    
    <link rel="apple-touch-icon" href="/img/mapzoneforandroid.png">
    <link rel="apple-touch-icon-precomposed" href="/img/mapzoneforandroid.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/androidthere.png" alt="Android 学习之道" title="Android 学习之道"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Android 学习之道">Android 学习之道</a></h1>
				<h2 class="blog-motto">生命不息，奋斗不止</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于我</a></li>
					
						<li><a href="/categories">分类</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/04/06/Android7.0机型适配/" title="Android7.0机型适配" itemprop="url">Android7.0机型适配</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="小强" target="_blank" itemprop="author">小强</a>
		
  <p class="article-time">
    <time datetime="2017-04-06T14:30:20.000Z" itemprop="datePublished"> 发表于 2017-04-06</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Android7-0机型适配存储目录的共享"><span class="toc-number">1.</span> <span class="toc-text">Android7.0机型适配存储目录的共享</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#FileProvider介绍"><span class="toc-number">1.0.1.</span> <span class="toc-text">FileProvider介绍</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方式"><span class="toc-number">2.</span> <span class="toc-text">使用方式</span></a></li></ol>
		
		</div>
		
		<h3 id="Android7-0机型适配存储目录的共享"><a href="#Android7-0机型适配存储目录的共享" class="headerlink" title="Android7.0机型适配存储目录的共享"></a>Android7.0机型适配存储目录的共享</h3><p>都知道现在AI都很火，AI必定会诞生一些下一代巨头企业，各行各业都争抢这一股风，百度CEO不扔下了公司的内务不管，一头扎进了AI的研究团队工作中，前段时间李彦宏驾着自己公司生产的无人驾驶汽车，就是6，各个大巨头都在AI方面有重要项目在实施，都争抢着下一个时代的山头。在物联网方面，做的不错的是小米，小米的生态链，聚集了70多家智能硬件公司，形成了小米生态链，未来的小米将会在物联网将是一个大赢家，我们知道的小米路由器，小米手环，小米扫地机器人等都是这70多家公司中来生产和研发的，雷军太有远见了。好了，不闲说了，进入正题，记录一下我吗7.0版本对使用存储的要求。<img src="https://user-gold-cdn.xitu.io/2017/11/9/273e2014d8fa7673c6d438ebe50a592f?w=640&amp;h=426&amp;f=jpeg&amp;s=47213" alt=""><br><img src="https://user-gold-cdn.xitu.io/2017/11/9/ec8c02abbf21a89ed4daffd611b8e6d5?w=640&amp;h=457&amp;f=jpeg&amp;s=42366" alt=""></p>
<pre><code>最近根据需求做了在线更新app问题，起初没有对7.0以上的机型进行
适配，造成7.0手机无法跳转到app安装界面。
   说一下吧，android系统发展越来越好用，用户体验越来越好，对
用户的隐私也进行了一定规范性的保护，我们都知道从6.0系统的开始
goole就开始对app使用手机权限进行了一定的约束，对于6.0以上 
的权限申请我就不多说了，对于权限申请，自己写了一个框架，在项
目中使用很方便。下面我们就说说7.0系统对存储使用增加
了“FileProvider”,我们来看看使用方式，阅读一下官方文档。
</code></pre><h5 id="FileProvider介绍"><a href="#FileProvider介绍" class="headerlink" title="FileProvider介绍"></a>FileProvider介绍</h5><p><a>FileProvider is a special subclass of ContentProvider that facilitates secure sharing of files associated with an app by creating a content:// Uri for a file instead of a file:/// Uri.<br>A content URI allows you to grant read and write access using temporary access permissions. When<br>you create an Intent containing a contentURI, in<br>order to send the content URI to a client app, you     can also call Intent.setFlags() to add permissions. These permissions are available to the client app for as long as the stack for a receiving Activity is active. For an Intent going to a Service, the permissions are available as long as the Service is running.</a></p>
<p>In comparison, to control access to a file:/// Uri you have to modify the file system permissions of the underlying file. The permissions you provide become available to any app, and remain in effect until you change them. This level of access is fundamentally insecure.</p>
<p>The increased level of file access security offered by a content URI makes FileProvider a key part of Android’s security infrastructure.</p>
<p>This overview of FileProvider includes the following topics:<a></a></p>
<p> 意思就是说<br> <a><br> FileProvider是一个特殊的ContentProvider子类，它通过为文件创建一个Content:/ / Uri而不是file:/ / Uri，从而促进与应用程序关联的文件的安全共享。</a></p>
<p>内容URI允许您使用临时访问权限授予读和写访问。当您创建包含内容URI的意图时，为了将内容URI发送到客户机应用程序，您还可以调用intent. setflags()来添加权限。只要接收活动的堆栈是活动的，客户机应用程序就可以使用这些权限。为了获得服务，只要服务运行，权限就可用。</p>
<p>相比之下，为了控制对文件的file:/ / / Uri，您必须修改底层文件的文件系统权限。您提供的权限对任何应用程序都可用，并且一直有效，直到您更改它们为止。这种级别的访问基本上是不安全的。</p>
<p>由内容URI提供的文件访问安全性的提高使得FileProvider成为Android安全基础设施的关键部分。<br> <a></a></p>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><p>1.在程序清单文件中添加代码：</p>
<pre><code>&lt;manifest&gt;
...
&lt;application&gt;
   ...
   &lt;provider  android:name= &quot;android.support.v4.content.FileProvid&quot;  
        android:authorities=&quot;com.mydomain.fileprovider&quot;
        android:exported=&quot;false&quot;
        android:grantUriPermissions=&quot;true&quot;&gt;
                   &lt;!--元数据--&gt;
        &lt;meta-data
            android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;
            android:resource=&quot;@xml/file_path&quot; /&gt;
    &lt;/provider&gt;
    ...
&lt;/application&gt;
&lt;/manifest&gt;
</code></pre><p> com.mydomain更换成自己项目的包名，唯一性。</p>
<p>2.在res目录下新建一个xml文件夹，文件下新建一个xml文件“file_path”</p>
<p>3.file_path文件写法</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
&lt;paths&gt;
    &lt;root-path name=&quot;download&quot; path=&quot;&quot;/&gt;
&lt;/paths&gt;
&lt;/resources&gt;
</code></pre><p> 根据我们使用的存储路径不同，对第三层的配置也不一样。</p>
<pre><code>（1）当我们使用Context.getFilesDir()获取路径时我们应该配
置成 &lt;files-path name=&quot;name&quot; path=&quot;path&quot; /&gt;
（2）当我们使用getCacheDir()获取存储路径时，应该配置成
&lt;cache-path name=&quot;name&quot; path=&quot;path&quot; /&gt;
（3）使用Environment.getExternalStorageDirectory()
获取目录时，&lt;root-path name=&quot;download&quot; path=&quot;&quot;/&gt;，path值可以为null，null代表授权这个目录下的所有文件，name必须写，不然会报严重异常
（4）使用Context.getExternalCacheDir()
&lt;external-cache-path name=&quot;name&quot; path=&quot;path&quot; /&gt;
（5）使用Context.getExternalFilesDir(null)配置成
&lt;external-files-path name=&quot;name&quot; path=&quot;path&quot; /&gt;
</code></pre><p>另外，我们在跳转到安装目录代码有变如下：</p>
<pre><code> public static void install(Context context,String target) {
    File file = new File(target);
    Intent intent = new Intent(Intent.ACTION_VIEW);
    // 由于没有在Activity环境下启动Activity,设置下面的标签
    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
    if(Build.VERSION.SDK_INT&gt;=24) { //判读版本是否在7.0以上
        //参数1 上下文, 参数2 Provider主机地址 和配置文件中保持一致   参数3  共享的文件
        Uri apkUri =
                FileProvider.getUriForFile(context, &quot;com.gzzhe.zhhwlkj.zigou.fileprovider&quot;, file);
        //添加这一句表示对目标应用临时授权该Uri所代表的文件
        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
        intent.setDataAndType(apkUri, &quot;application/vnd.android.package-archive&quot;);
    }else{
        intent.setDataAndType(Uri.fromFile(file),
                &quot;application/vnd.android.package-archive&quot;);
    }
    context.startActivity(intent);
}
</code></pre><p> 好了就介绍到这儿吧。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2017/04/06/Android7.0机型适配/" data-title="Android7.0机型适配 | Android 学习之道" data-tsina="5841996534" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/04/16/程序员离开北上广的日子/" title="程序员离开北上广的日子">
  <strong>上一篇：</strong><br/>
  <span>
  程序员离开北上广的日子</span>
</a>
</div>


<div class="next">
<a href="/2017/04/06/IntentFilter/"  title="IntentFilter">
 <strong>下一篇：</strong><br/> 
 <span>IntentFilter
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Android7-0机型适配存储目录的共享"><span class="toc-number">1.</span> <span class="toc-text">Android7.0机型适配存储目录的共享</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#FileProvider介绍"><span class="toc-number">1.0.1.</span> <span class="toc-text">FileProvider介绍</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方式"><span class="toc-number">2.</span> <span class="toc-text">使用方式</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="sudeqiangxx" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=5841996534&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 码神之道，逢敌必亮剑。 <br/>
			码出一个家，码出一个世界。</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5841996534" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/sudeqiangxx" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		<a href="http://www.zhihu.com/people/su-de-qiang-41" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:1320909689@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="小强">小强</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
